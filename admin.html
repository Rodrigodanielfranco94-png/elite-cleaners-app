<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Cleaners - Admin Control</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        body { background: #000; color: white; font-family: -apple-system, sans-serif; margin: 0; padding: 15px; }
        .form-container { background: #1c1c1e; padding: 18px; border-radius: 18px; border: 1px solid #2c2c2e; margin-bottom: 20px; }
        input, textarea { width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 10px; border: 1px solid #2c2c2e; background: #2c2c2e; color: white; box-sizing: border-box; }
        .save-btn { width: 100%; padding: 18px; background: #1d4ed8; color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .card-servicio { background: #1c1c1e; padding: 15px; border-radius: 15px; border: 1px solid #2c2c2e; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1 style="font-style: italic; font-weight: 900; text-transform: uppercase;">ELITE <span style="color: #3b82f6;">ADMIN</span></h1>

    <div class="form-container">
        <input type="hidden" id="edit-id">
        <input type="text" id="cliente" placeholder="Nombre del cliente">
        <input type="text" id="direccion" placeholder="Direcci√≥n">
        <input type="email" id="empleado" placeholder="Correo del empleado">
        <input type="date" id="fecha">
        <input type="time" id="hora">
        <textarea id="notas" placeholder="Instrucciones especiales..." rows="2"></textarea>
        <button class="save-btn" onclick="guardarServicio()">GUARDAR Y NOTIFICAR</button>
    </div>

    <div id="historial"></div>

    <script>
        // CONFIGURACI√ìN VERIFICADA SEG√öN TUS IM√ÅGENES
        emailjs.init("HND0NNg6H-dBCZtNq"); // Tu Public Key

        const firebaseConfig = {
            apiKey: "AIzaSyDB4F55StoX8WYYzCm8oSnucc-lrH",
            authDomain: "elite-cleaners-app.firebaseapp.com",
            projectId: "elite-cleaners-app",
            storageBucket: "elite-cleaners-app.appspot.com",
            messagingSenderId: "826642317319",
            appId: "1:826642317319:web:cddce7904b590ae"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function guardarServicio() {
            const correoEmp = document.getElementById('empleado').value;
            const data = {
                cliente: document.getElementById('cliente').value,
                direccion: document.getElementById('direccion').value,
                empleado: correoEmp,
                fecha: document.getElementById('fecha').value,
                hora: document.getElementById('hora').value,
                notas: document.getElementById('notas').value,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            if(!data.cliente || !correoEmp) return alert("Faltan datos");

            db.collection("servicios").add(data).then(() => {
                // ENV√çO USANDO TUS IDs DE LAS CAPTURAS
                emailjs.send("service_10ipt7l", "template_r1nt4zb", {
                    to_email: correoEmp, // Variable exacta de tu plantilla
                    client_name: data.cliente, // Variable exacta de tu asunto
                    address: data.direccion,
                    date_time: data.fecha + " " + data.hora,
                    notes: data.notas
                }).then(() => {
                    alert("üöÄ √âXITO: Guardado y enviado a " + correoEmp);
                    location.reload();
                }).catch(err => alert("Error EmailJS: " + JSON.stringify(err)));
            });
        }

        function cargarDatos() {
            db.collection("servicios").orderBy("timestamp", "desc").onSnapshot(snap => {
                const h = document.getElementById('historial');
                h.innerHTML = "";
                snap.forEach(doc => {
                    const s = doc.data();
                    const card = document.createElement('div');
                    card.className = 'card-servicio';
                    card.innerHTML = `<h3>${s.cliente}</h3><p>üìç ${s.direccion}</p><p>üìß ${s.empleado}</p>`;
                    h.appendChild(card);
                });
            });
        }
        cargarDatos();
    </script>
</body>
</html>
